const e=new class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.restart()}move(e){if("playing"!==this.status)return;let t=[],s=[],i=!1,o=this.getMoveConfig(e);for(let e=0;e<4;e++){let a=this.getLine(e,o),r=this.processLine(a,e,o,t,s);r.moved&&(i=!0),this.setLine(e,r.newLine,o)}i&&this.animateMove(t,s,()=>{this.addRandomTile(),this.checkGameOver()})}getMoveConfig(e){return({left:{extractLine:e=>this.board[e],updateLine:(e,t)=>{this.board[e]=t},getCoords:(e,t)=>({row:e,col:t}),reverse:!1,startPos:0,increment:1},right:{extractLine:e=>this.board[e],updateLine:(e,t)=>{this.board[e]=t},getCoords:(e,t)=>({row:e,col:t}),reverse:!0,startPos:3,increment:-1},up:{extractLine:e=>this.board.map(t=>t[e]),updateLine:(e,t)=>{for(let s=0;s<4;s++)this.board[s][e]=t[s]},getCoords:(e,t)=>({row:t,col:e}),reverse:!1,startPos:0,increment:1},down:{extractLine:e=>this.board.map(t=>t[e]),updateLine:(e,t)=>{for(let s=0;s<4;s++)this.board[s][e]=t[s]},getCoords:(e,t)=>({row:t,col:e}),reverse:!0,startPos:3,increment:-1}})[e]}getLine(e,t){return t.extractLine(e)}setLine(e,t,s){s.updateLine(e,t)}processLine(e,t,s,i,o){let a=this.getNonZeroTiles(e,s),r=s.reverse?[0,0,0,0]:[],l=s.startPos,d=!1;for(let e=0;e<a.length;e++){let n=a[e],c=a[e+1];if(c&&n.value===c.value){let a=2*n.value;s.reverse?r[l]=a:r.push(a),this.addMoveAnimation(n,l,t,s,i),this.addMoveAnimation(c,l,t,s,i),o.push({position:s.getCoords(t,l),value:a}),this.score+=a,e++,d=!0}else s.reverse?r[l]=n.value:r.push(n.value),n.from!==l&&(this.addMoveAnimation(n,l,t,s,i),d=!0);l+=s.increment}if(!s.reverse)for(;r.length<4;)r.push(0);return{newLine:r,moved:d}}getNonZeroTiles(e,t){let s=[];for(let i of t.reverse?[3,2,1,0]:[0,1,2,3])0!==e[i]&&s.push({value:e[i],from:i,to:t.reverse?3-s.length:s.length});return s}addMoveAnimation(e,t,s,i,o){o.push({from:i.getCoords(s,e.from),to:i.getCoords(s,t),value:e.value})}moveLeft(){this.move("left")}moveRight(){this.move("right")}moveUp(){this.move("up")}moveDown(){this.move("down")}animateMove(e,t,s){if(0===e.length){s();return}let i=[];e.forEach(e=>{let t=document.querySelector(`[data-position="${e.from.row}-${e.from.col}"]`),s=document.querySelector(`[data-position="${e.to.row}-${e.to.col}"]`),o=document.createElement("div");o.className=`field-cell field-cell--${e.value}`,o.textContent=e.value;let a=t.getBoundingClientRect(),r=document.querySelector(".game-field"),l=r.getBoundingClientRect();o.style.position="absolute",o.style.left=`${a.left-l.left}px`,o.style.top=`${a.top-l.top}px`,o.style.width=`${a.width}px`,o.style.height=`${a.height}px`,o.style.zIndex="10",o.style.transition="all 0.2s ease-in-out",r.style.position="relative",r.appendChild(o),i.push(o),t.textContent="",t.className="field-cell",requestAnimationFrame(()=>{let e=s.getBoundingClientRect();o.style.left=`${e.left-l.left}px`,o.style.top=`${e.top-l.top}px`})}),setTimeout(()=>{i.forEach(e=>e.remove()),this.updateDisplay(),t.forEach(e=>{let t=document.querySelector(`[data-position="${e.position.row}-${e.position.col}"]`);t.classList.add("field-cell--merged"),setTimeout(()=>{t.classList.remove("field-cell--merged")},150)}),s()},200)}updateDisplay(){this.getState().forEach((e,t)=>{e.forEach((e,s)=>{let i=document.querySelector(`[data-position="${t}-${s}"]`);i.textContent=0!==e?e:"",this.updateCellClass(i,e)})})}updateCellClass(e,t){let s=e.classList.contains("field-cell--new"),i=e.classList.contains("field-cell--merged"),o=[];e.classList.forEach(e=>{!e.startsWith("field-cell--")||e.includes("new")||e.includes("merged")||o.push(e)}),o.forEach(t=>e.classList.remove(t)),0!==t&&e.classList.add(`field-cell--${t}`),s&&e.classList.add("field-cell--new"),i&&e.classList.add("field-cell--merged")}getScore(){return this.score}getState(){return this.board.map(e=>[...e])}getStatus(){return this.status}start(){this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.board=this.initialState.map(e=>[...e]),this.score=0,this.status="idle"}checkGameOver(){this.board.some(e=>e.includes(2048))?this.status="win":this.canMove()||(this.status="lose")}canMove(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t]||t<3&&this.board[e][t]===this.board[e][t+1]||e<3&&this.board[e][t]===this.board[e+1][t])return!0;return!1}addRandomTile(){let e=[];if(this.board.forEach((t,s)=>{t.forEach((t,i)=>{0===t&&e.push({rowIndex:s,colIndex:i})})}),e.length>0){let t=Math.floor(Math.random()*e.length),{rowIndex:s,colIndex:i}=e[t];this.board[s][i]=.9>Math.random()?2:4;let o=document.querySelector(`[data-position="${s}-${i}"]`);o.textContent=this.board[s][i],this.updateCellClass(o,this.board[s][i]),requestAnimationFrame(()=>{o.classList.add("field-cell--new"),setTimeout(()=>{o.classList.remove("field-cell--new")},300)})}}},t=document.querySelector(".game-score"),s=document.getElementById("startButton"),i=document.querySelector(".message-start"),o=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),r=document.querySelector(".message-playing");function l(){e.updateDisplay()}function d(){t.textContent=e.getScore()}function n(){let t=e.getStatus();"win"===t?(o.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden"),r.classList.add("hidden")):"lose"===t?(a.classList.remove("hidden"),o.classList.add("hidden"),i.classList.add("hidden"),r.classList.add("hidden")):"playing"===t?(r.classList.remove("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),a.classList.add("hidden")):(i.classList.remove("hidden"),o.classList.add("hidden"),a.classList.add("hidden"),r.classList.add("hidden"))}s.addEventListener("click",()=>{s.classList.contains("start")?(e.start(),l(),n(),s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart"):(e.restart(),l(),d(),n(),s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start")});let c=!1;window.addEventListener("keydown",t=>{if(!c){switch(t.key){case"ArrowLeft":c=!0,e.moveLeft();break;case"ArrowRight":c=!0,e.moveRight();break;case"ArrowUp":c=!0,e.moveUp();break;case"ArrowDown":c=!0,e.moveDown();break;default:return}setTimeout(()=>{d(),n(),c=!1},350)}});
//# sourceMappingURL=index.62f6c2f6.js.map
