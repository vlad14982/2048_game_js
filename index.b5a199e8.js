!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,void 0);var o=Object.prototype.toString.call(t).slice(8,-1);if("Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=new/*#__PURE__*/(function(){var e;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),this.initialState=e,this.restart()}return e=[{key:"move",value:function(e){var t=this;if("playing"===this.status){for(var n=[],o=[],r=!1,a=this.getMoveConfig(e),i=0;i<4;i++){var s=this.getLine(i,a),c=this.processLine(s,i,a,n,o);c.moved&&(r=!0),this.setLine(i,c.newLine,a)}r&&this.animateMove(n,o,function(){t.addRandomTile(),t.checkGameOver()})}}},{key:"getMoveConfig",value:function(e){var t=this;return({left:{extractLine:function(e){return t.board[e]},updateLine:function(e,n){t.board[e]=n},getCoords:function(e,t){return{row:e,col:t}},reverse:!1,startPos:0,increment:1},right:{extractLine:function(e){return t.board[e]},updateLine:function(e,n){t.board[e]=n},getCoords:function(e,t){return{row:e,col:t}},reverse:!0,startPos:3,increment:-1},up:{extractLine:function(e){return t.board.map(function(t){return t[e]})},updateLine:function(e,n){for(var o=0;o<4;o++)t.board[o][e]=n[o]},getCoords:function(e,t){return{row:t,col:e}},reverse:!1,startPos:0,increment:1},down:{extractLine:function(e){return t.board.map(function(t){return t[e]})},updateLine:function(e,n){for(var o=0;o<4;o++)t.board[o][e]=n[o]},getCoords:function(e,t){return{row:t,col:e}},reverse:!0,startPos:3,increment:-1}})[e]}},{key:"getLine",value:function(e,t){return t.extractLine(e)}},{key:"setLine",value:function(e,t,n){n.updateLine(e,t)}},{key:"processLine",value:function(e,t,n,o,r){for(var a=this.getNonZeroTiles(e,n),i=n.reverse?[0,0,0,0]:[],s=n.startPos,c=!1,l=0;l<a.length;l++){var u=a[l],d=a[l+1];if(d&&u.value===d.value){var f=2*u.value;n.reverse?i[s]=f:i.push(f),this.addMoveAnimation(u,s,t,n,o),this.addMoveAnimation(d,s,t,n,o),r.push({position:n.getCoords(t,s),value:f}),this.score+=f,l++,c=!0}else n.reverse?i[s]=u.value:i.push(u.value),u.from!==s&&(this.addMoveAnimation(u,s,t,n,o),c=!0);s+=n.increment}if(!n.reverse)for(;i.length<4;)i.push(0);return{newLine:i,moved:c}}},{key:"getNonZeroTiles",value:function(e,t){var n=[],o=t.reverse?[3,2,1,0]:[0,1,2,3],r=!0,a=!1,i=void 0;try{for(var s,c=o[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var l=s.value;0!==e[l]&&n.push({value:e[l],from:l,to:t.reverse?3-n.length:n.length})}}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}},{key:"addMoveAnimation",value:function(e,t,n,o,r){r.push({from:o.getCoords(n,e.from),to:o.getCoords(n,t),value:e.value})}},{key:"moveLeft",value:function(){this.move("left")}},{key:"moveRight",value:function(){this.move("right")}},{key:"moveUp",value:function(){this.move("up")}},{key:"moveDown",value:function(){this.move("down")}},{key:"animateMove",value:function(e,t,n){var o=this;if(0===e.length){n();return}var r=[];e.forEach(function(e){var t=document.querySelector('[data-position="'.concat(e.from.row,"-").concat(e.from.col,'"]')),n=document.querySelector('[data-position="'.concat(e.to.row,"-").concat(e.to.col,'"]')),o=document.createElement("div");o.className="field-cell field-cell--".concat(e.value),o.textContent=e.value;var a=t.getBoundingClientRect(),i=document.querySelector(".game-field"),s=i.getBoundingClientRect();o.style.position="absolute",o.style.left="".concat(a.left-s.left,"px"),o.style.top="".concat(a.top-s.top,"px"),o.style.width="".concat(a.width,"px"),o.style.height="".concat(a.height,"px"),o.style.zIndex="10",o.style.transition="all 0.2s ease-in-out",i.style.position="relative",i.appendChild(o),r.push(o),t.textContent="",t.className="field-cell",requestAnimationFrame(function(){var e=n.getBoundingClientRect();o.style.left="".concat(e.left-s.left,"px"),o.style.top="".concat(e.top-s.top,"px")})}),setTimeout(function(){r.forEach(function(e){return e.remove()}),o.updateDisplay(),t.forEach(function(e){var t=document.querySelector('[data-position="'.concat(e.position.row,"-").concat(e.position.col,'"]'));t.classList.add("field-cell--merged"),setTimeout(function(){t.classList.remove("field-cell--merged")},150)}),n()},200)}},{key:"updateDisplay",value:function(){var e=this;this.getState().forEach(function(t,n){t.forEach(function(t,o){var r=document.querySelector('[data-position="'.concat(n,"-").concat(o,'"]'));r.textContent=0!==t?t:"",e.updateCellClass(r,t)})})}},{key:"updateCellClass",value:function(e,t){var n=e.classList.contains("field-cell--new"),o=e.classList.contains("field-cell--merged"),r=[];e.classList.forEach(function(e){!e.startsWith("field-cell--")||e.includes("new")||e.includes("merged")||r.push(e)}),r.forEach(function(t){return e.classList.remove(t)}),0!==t&&e.classList.add("field-cell--".concat(t)),n&&e.classList.add("field-cell--new"),o&&e.classList.add("field-cell--merged")}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.board.map(function(e){return t(e)})}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status="playing",this.addRandomTile(),this.addRandomTile()}},{key:"restart",value:function(){this.board=this.initialState.map(function(e){return t(e)}),this.score=0,this.status="idle"}},{key:"checkGameOver",value:function(){this.board.some(function(e){return e.includes(2048)})?this.status="win":this.canMove()||(this.status="lose")}},{key:"canMove",value:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(0===this.board[e][t]||t<3&&this.board[e][t]===this.board[e][t+1]||e<3&&this.board[e][t]===this.board[e+1][t])return!0;return!1}},{key:"addRandomTile",value:function(){var e=[];if(this.board.forEach(function(t,n){t.forEach(function(t,o){0===t&&e.push({rowIndex:n,colIndex:o})})}),e.length>0){var t=Math.floor(Math.random()*e.length),n=e[t],o=n.rowIndex,r=n.colIndex;this.board[o][r]=.9>Math.random()?2:4;var a=document.querySelector('[data-position="'.concat(o,"-").concat(r,'"]'));a.textContent=this.board[o][r],this.updateCellClass(a,this.board[o][r]),requestAnimationFrame(function(){a.classList.add("field-cell--new"),setTimeout(function(){a.classList.remove("field-cell--new")},300)})}}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,e),n}()),o=document.querySelector(".game-score"),r=document.getElementById("startButton"),a=document.querySelector(".message-start"),i=document.querySelector(".message-win"),s=document.querySelector(".message-lose"),c=document.querySelector(".message-playing");function l(){n.updateDisplay()}function u(){o.textContent=n.getScore()}function d(){var e=n.getStatus();"win"===e?(i.classList.remove("hidden"),s.classList.add("hidden"),a.classList.add("hidden"),c.classList.add("hidden")):"lose"===e?(s.classList.remove("hidden"),i.classList.add("hidden"),a.classList.add("hidden"),c.classList.add("hidden")):"playing"===e?(c.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden"),s.classList.add("hidden")):(a.classList.remove("hidden"),i.classList.add("hidden"),s.classList.add("hidden"),c.classList.add("hidden"))}r.addEventListener("click",function(){r.classList.contains("start")?(n.start(),l(),d(),r.classList.remove("start"),r.classList.add("restart"),r.textContent="Restart"):(n.restart(),l(),u(),d(),r.classList.remove("restart"),r.classList.add("start"),r.textContent="Start")});var f=!1;window.addEventListener("keydown",function(e){if(!f){switch(e.key){case"ArrowLeft":f=!0,n.moveLeft();break;case"ArrowRight":f=!0,n.moveRight();break;case"ArrowUp":f=!0,n.moveUp();break;case"ArrowDown":f=!0,n.moveDown();break;default:return}setTimeout(function(){u(),d(),f=!1},350)}})}();
//# sourceMappingURL=index.b5a199e8.js.map
